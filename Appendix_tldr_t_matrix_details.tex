% !TEX root = More_PhD_Thesis.tex
% !TEX encoding = UTF-8 Unicode
% !TEX spellcheck = en_US
\cleardoublepage
\chapter{$t$-matrix details}
\label{Appendix:t_matrix_details}

  \section{Solving the Lippmann-Schwinger equation}

  The Lippmann-Schwinger equation (LSE), which is essentially the
  Schr\"{o}dinger equation for scattering states is given in operator form by
  %
  \beq
  t = V + V \, G \, t \;,
  \label{eq:LSE_operator_form}
  \eeq
  %
  where $t$ is the $t$-matrix, $V$ is the potential, and $G$ is the Green's
  function.  In momentum space, Eq.~\eqref{eq:LSE_operator_form} becomes
  \beq
  t_{\lp l} (E_0 \!=\! p_0^2/M ; \pp, p) = V_{\lp l} + \sum_{\lpp}
  \frac{2}{\pi} M \int \frac{\dd \ppp \, {\ppp}^2 V_{l \lpp}(\pp, \ppp) \,
    t_{\lpp l}(E_0; \ppp, p)}{p_0^2 - {\pp}^2 + i \epsilon} \;.
  \label{eq:t_matrix_mom_space}
  \eeq
  Derivation of Eq.~\eqref{eq:t_matrix_mom_space} makes use of the completeness
  relation in Eq.~\eqref{eq:completeness_partial_wave} and the definition of
  Green's function in Eq.~\eqref{eq:G0_def_pw}.   The indices which are the
  same on both sides of Eq.~\eqref{eq:t_matrix_mom_space} and are not summed
  over are suppressed.  For deuteron disintegration calculations, we need only
  the half on-shell $t$-matrix.  But here we will look at the more general case
  of evaluating the fully off-shell $t$-matrix.

  For the sake of pedagogy, let us consider that we are evaluating the
  $t$-matrix for uncoupled channels.  Suppressing the angular momentum indices
  and putting in the limits of integration,
  the Eq.~\eqref{eq:t_matrix_mom_space} becomes
  \beq
  t(E_0; \pp, p) = V(\pp, p) + \frac{2}{\pi} M \int_0 ^\Lambda
  \frac{\dd \ppp \, {\ppp}^2
  V(\pp, \ppp)\, t(E_0; \ppp, p)}{p_0^2 - {\ppp}^2 + i \epsilon} \;.
  \label{eq:t_uncoupled_channels}
  \eeq
  %
  Next we outline the steps involved in solving
  Eq.~\eqref{eq:t_uncoupled_channels} numerically.  We follow the approach of
  Ref.~\cite{Landau:1989}.

  The integrals are efficiently evaluated numerically using a Gauss-Legendre
  quadrature.  However, the integrand in Eq.~\eqref{eq:t_uncoupled_channels} has
  a pole at $\ppp = p_0$, and that needs to be accounted for properly.
  Let's consider the expression
  \bea
  \label{eq:separating_pole_first_step}
  \int_0 ^\Lambda \dd p \frac{p^2 f(p)}{p_0^2 - p^2 + i \epsilon}
  &=& \int_0 ^\Lambda \dd p \frac{p^2 f(p)}{(p_0 + p)(p_0 - p + i \epsilon)}
  \\ [0.4 em]
  &\equiv& \int_0 ^\Lambda \dd p \frac{\wt{f}(p)}{(p_0 - p + i \epsilon)} \;,
  \label{eq:separating_pole}
  \eea
  where we have defined $\wt{f}(p)$ as
  \beq
  \wt{f}(p) = \frac{p^2 \, f(p)}{p_0 + p} \;.
  \eeq
  %
  In principle, we can work without separating the singular and non-singular
  factors of $p_0^2 - p^2 + i \epsilon$.  However, we find better numerical
  convergence when the pole term is factorized as in
  Eq.~\eqref{eq:separating_pole_first_step}.

  Using Sokhotsky's formula
  \beq
  \frac{1}{x \pm i \epsilon} = \mathcal{P} \left(\frac{1}{x}\right) \mp i \,
  \pi \, \delta(x) \;,
  \eeq
  we have
  \beq
  \int_0 ^\Lambda \dd p \frac{\wt{f}(p)}{(p_0 - p + i \epsilon)} =
  \mathcal{P} \int_0 ^\Lambda \dd p \frac{\wt{f}(p)}{p_0 - p}  - i \, \pi \,
  \wt{f}(p_0)\;.
  \label{eq:f_tilde_simple_pole}
  \eeq
  %
  Let's first evaluate the principal value integration in the
  Eq.~\eqref{eq:f_tilde_simple_pole}.
  \bea
  \mathcal{P} \int_0 ^\Lambda \dd p \frac{\wt{f}(p)}{p_0 - p}
  & = &  \mathcal{P} \int_0 ^\Lambda \dd p \frac{\wt{f}(p) - \wt{f}(p_0) +
  \wt{f}(p_0)}{p_0 - p} \nonumber \\ [0.4 em]
  & = & \int_0 ^\Lambda \dd p \frac{\wt{f}(p) - \wt{f}(p_0)}{p_0 - p} +
  \wt{f}(p_0) \, \mathcal{P} \int_0 ^\Lambda \dd p \frac{1}{p_0 - p} \;.
  \label{eq:add_subtract_pole}
  \eea
  %
  The integrand of the first term on the right side of
  Eq.~\eqref{eq:add_subtract_pole} is zero at the pole $p = p_0$ and therefore
  non-singular.  We can therefore drop the principal value for that term and
  evaluate it as a normal integral.  The second term on the right side of
  Eq.~\eqref{eq:add_subtract_pole} can be evaluated analytically.
  \bea
  \mathcal{P} \int_0 ^\Lambda \dd p \frac{1}{p_0 - p}
  & = & \int_0 ^{p_0 - \epsilon} \dd p \frac{1}{p_0 - p} +
  \int_{p_0 + \epsilon} ^\Lambda \dd p \frac{1}{p_0 - p} \nonumber \\ [0.5 em]
  & = &  \null - {\rm{ln}}(p_0 - p) \Big\vert_0 ^{p_0 - \epsilon} +
         \null - {\rm{ln}}(p_0 - p) \Big\vert_{p_0 + \epsilon} ^\Lambda
         \nonumber \\ [0.5 em]
  & = & - {\rm{ln}}\left(\frac{\Lambda - p_0}{p_0}\right)\;.
  \label{eq:PV_1_over_x}
  \eea
  %
  From Eqs.~\eqref{eq:PV_1_over_x}, \eqref{eq:add_subtract_pole}, and
  \eqref{eq:f_tilde_simple_pole}, we have
  \begin{equation}
  \int_0 ^\Lambda \dd p \frac{\wt{f}(p)}{p_0 - p + i \epsilon}
  = \int_0 ^\Lambda \dd p \frac{\wt{f}(p) - \wt{f}(p_0)}{p_0 - p} -
  \wt{f}(p_0) \, {\rm{ln}}\left(\frac{\Lambda - p_0}{p_0}\right)
  \null - i \, \pi \, \wt{f}(p_0)\;.
  \end{equation}
  %
  Discretizing this on the Gauss-Legendre mesh we have
  \beq
  \int_0 ^\Lambda \dd p \frac{\wt{f}(p)}{p_0 - p + i \epsilon}
  = \sum_{j = 1}^N \frac{\wt{f}(p_j)}{p_0 - p_j} w_j - \wt{f}(p_0)
  \left[ i \pi + {\rm{ln}}\big(\frac{\Lambda - p_0}{p_0}\big) + \sum_{j=1}^N
  \frac{w_j}{p_0 - p_j}\right] \;.
  \label{eq:pole_GL}
  \eeq
  $p_j$'s are the momentum mesh points, $N$ is the number of mesh points,
  and $w_j$'s are the associated weights.

  Comparing Eqs.~\eqref{eq:t_uncoupled_channels} and
  Eq.~\eqref{eq:separating_pole}, the corresponding $\wt{f}$ function for
  the LSE is
  \beq
  \wt{f}(\ppp) = \frac{2}{\pi} M \frac{{\ppp}^2 V(\pp, \ppp) \, t(E_0; \ppp, p)}
  {(p_0 + \ppp)} \;.
  \eeq
  %
  Using the result of Eq.~\eqref{eq:pole_GL}, the LSE from
  Eq.~\eqref{eq:t_uncoupled_channels} on the Gauss-Legendre mesh becomes
  %
  \begin{multline}
  t(E_0; \pp, p) = V(\pp, p) + \frac{2}{\pi} M \sum_{j = 1}^N
  \frac{k_j^2 \, V(\pp, k_j) \, t(E_0; k_j, p)}{p_0^2 - k_j^2} w_j \\
  \null - \frac{2}{\pi} M \frac{p_0^2 \, V(\pp, p_0) \, t(E_0; p_0, p)}{2 p_0}
  \left[ i \pi + {\rm{ln}}\big(\frac{\Lambda - p_0}{p_0}\big)
  + \sum_{j = 1}^N \frac{w_j}{p_0 - k_j} \right] \;.
  \label{eq:LSE_GL}
  \end{multline}
  %
  Note that $k_j$ are Gauss-Legendre momentum mesh points and $w_j$ are the
  corresponding weights.

  Let's define an array $D$ such that
  \beq
  D_j = \left\{ \begin{array}{ll}
          \dfrac{2}{\pi} M \dfrac{k_j^2 \, w_j}{p_0^2 - k_j^2}
          \mbox{~~~~for $j = 1, \cdots, N$} \\ [0.7em]
          -\dfrac{2}{\pi} M \dfrac{p_0^2}{2 p_0} \Big( i \pi + {\rm{ln}}\big(
          \dfrac{\Lambda - p_0}{p_0}\big) + \sum_{j = 1}^N \dfrac{w_j}{p_0 - k_j}
          \Big) \mbox{~~for $j = N+ 1$}.
        \end{array} \right.
  \label{eq:D_def}
  \eeq
  %
  Using this definition of $D$ and with the identification that
  $k_{j = N+1} = p_0$, Eq.~\eqref{eq:LSE_GL} can be written as
  \beq
  t(E_0; \pp, p) - \sum_{j = 1}^{N+1} V(\pp, k_j) \, D_j \, t(E_0, k_j, p)
  = V(\pp, p) \;.
  \label{eq:t_D}
  \eeq

  To solve Eq.~\eqref{eq:t_D} in matrix form, we let $\pp \to \{p_i\}$,
  where $i = 1, \cdots, N$ are the Gauss-Legendre mesh points and $i = N+1$
  is the on-shell point $p = p_0$ \footnote{$k_i$'s and $p_i$'s are actually
  the same set of momentum points.  To avoid confusion, we keep the notation
  separate.}.  Eq.~\eqref{eq:t_D} can then be written as
  a matrix multiplication equation.
  \beq
  t(E_0; \pp_i, p) - \sum_{j = 1}^{N+1} V(p_i, k_j) \, D_j \, t(E_0, k_j, p)
  = V(\pp_i, p)
  \eeq
  \beq
  \sum_{j = 1}^{N+1} \underbrace{\big(\delta_{i j} - V(p_i, k_j) \, D_j\big)}
  _{\equiv \, F_{ij}} \, t(E_0, k_j, p)  =  V(p_i, p)
  \eeq
  \beq
  [F]_{(N+1)\times (N+1)} [t]_{N+1} = [V]_{N+1}
  \label{eq:F_t_matrix}
  \eeq
  %
  Note that $[V]$ in Eq.~\eqref{eq:F_t_matrix} is an array whose $N+1^{\rm{th}}$
  element is $V(p_0, p)$ and the first $N$ elements are $V(p_i, p)$, where as
  mentioned before $p_i$'s are the Gauss-Legendre mesh points.  The same
  indexing holds for $[t]$.

  $[F]$ and $[V]$ in Eq.~\eqref{eq:F_t_matrix} are
  known.  Eq.~\eqref{eq:F_t_matrix} can be solved using standard matrix equation
  solving subroutines to get the $t$-matrix array $[t]$.  Recall that
  $\displaystyle {[t] = \big( t(E_0; p_{j = 1,\cdots, N}, p), \, t(E_0; p_0, p)
  \big)}$.  Thus, for a given $p$ and $E_0$, we have the $t$-matrix
  $t(E_0; p_j, p)$ for any point $p_j$ on the Gauss-Legendre mesh, and also
  have it at the half on-shell point $t(E_0; p_0, p)$.  In principle, we can
  use any standard interpolation routine to get the $t$-matrix at a point
  not on the Gauss-Legendre mesh.  However, it turns out that we can use the
  LSE itself for interpolation.  Consider a point $\wt{p}$ not on the momentum
  mesh.  From Eq.~\eqref{eq:t_D}, we have
  \beq
  t(E_0; \wt{p}, p) = V(\wt{p}, p) + \sum_{j = 1}^{N+1}
  V(\wt{p}, k_j) \, D_j \, t(E_0, k_j, p) \;.
  \label{eq:t_interpolation}
  \eeq
  %
  As mentioned before $\{k_j\} = \{p_j\}$, and therefore all the terms on the
  right side of Eq.~\eqref{eq:t_interpolation} are known allowing us to
  evaluate $t(E_0; \wt{p}, p)$.  To interpolate the potential, which is stored
  on a momentum-space grid, we use
	the two-dimensional cubic spline algorithm from ALGLIB~\cite{ALGLIB:0915}.

  \medskip
  \subsubsection{Coupled channels}

  \emph{Add stuff about checking the $t$-matrix}


  \section{Using the LSE for interpolation}
